'use strict';
var _ = require('lodash');
var async = require('async');
var renderTemplate = require('./template').render;
var componentLoader = require('component-loader');

var renderComponent = function (componentPath, locale, loadData, callback){
  async.parallel([
    componentLoader.load.bind(null, componentPath, locale),
    loadData
  ], function (err, results) {
    var component = results[0];
    var data = results[1];

    var templateData = {};

    _.merge(templateData, data);
    _.merge(templateData, component.translations);

    var renderedComponent = renderTemplate(component.template, templateData);
    callback(renderedComponent);
  });
};

module.exports = {
  renderComponent: renderComponent
};

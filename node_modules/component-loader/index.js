'use strict';
var fs = require('fs');
var async = require('async');

var load = function (componentPath, locale, callback) {
  loadFiles(componentPath, locale, function(template, translations){
    var component = {
      template: template,
      translations: translations
    };
    callback(null, component);
  });
};
var loadFiles = function (componentPath, locale, callback) {
  async.parallel([
    getTemplate.bind(null, templateFilePath(componentPath)),
    getTranslations.bind(null, translationFilePath(componentPath, locale))
  ],function(err, results){
    var rawTemplate = results[0];
    var translations = results[1];

    callback(rawTemplate, translations);
  });
};

var readFile = function (filePath, callback) {
  fs.readFile(filePath, 'utf8', callback);
};

var getTranslations = function (translationPath, callback) {
  readFile(translationPath, function(err, dataRaw){
    var data = JSON.parse(dataRaw)
    callback(null, data);
  });
};

var getTemplate = function (templatePath, callback) {
  readFile(templatePath, function(err, data){
    callback(null, data);
  });
};

var templateFilePath = function (componentPath) {
  return componentPath + "/index.html.tpl";
};

var translationFilePath = function (componentPath, locale) {
  return componentPath + "/" + locale + ".json";
};

module.exports = {
  load: load
};
